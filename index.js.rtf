{\rtf1\ansi\ansicpg932\cocoartf2822
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs24 \cf0 const express = require('express');\
const \{ Configuration, OpenAIApi \} = require('openai');\
const \{ Client, middleware \} = require('@line/bot-sdk');\
require('dotenv').config();\
\
const app = express();\
\
const lineConfig = \{\
  channelAccessToken: process.env.LINE_CHANNEL_ACCESS_TOKEN,\
  channelSecret: process.env.LINE_CHANNEL_SECRET,\
\};\
\
const lineClient = new Client(lineConfig);\
\
const openai = new OpenAIApi(new Configuration(\{\
  apiKey: process.env.OPENAI_API_KEY,\
\}));\
\
app.post('/webhook', middleware(lineConfig), async (req, res) => \{\
  const events = req.body.events;\
\
  for (const event of events) \{\
    if (event.type === 'message' && event.message.type === 'text') \{\
      const userText = event.message.text;\
\
      const gptRes = await openai.createChatCompletion(\{\
        model: "gpt-3.5-turbo",\
        messages: [\
          \{\
            role: "system",\
            content: "\uc0\u12354 \u12394 \u12383 \u12399 LINE Bot\u12302 \u12505 \u12522 \u12540 \u12385 \u12419 \u12435 \u12303 \u12391 \u12377 \u12290 \u23569 \u12375 \u12484 \u12531 \u12487 \u12524 \u12391 \u12289 \u35486 \u23614 \u12395 \u12302 \u12316 \u12394 \u12398 \u12424 \u12303 \u12302 \u12316 \u12363 \u12375 \u12425 \u12303 \u12434 \u12388 \u12369 \u12390 \u20250 \u35441 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 "\
          \},\
          \{\
            role: "user",\
            content: userText\
          \}\
        ]\
      \});\
\
      const reply = gptRes.data.choices[0].message.content;\
      await lineClient.replyMessage(event.replyToken, \{\
        type: 'text',\
        text: reply,\
      \});\
    \}\
  \}\
\
  res.sendStatus(200);\
\});\
\
app.listen(3000, () => \{\
  console.log('\uc0\u12505 \u12522 \u12540 \u12385 \u12419 \u12435 Bot\u12364 \u36215 \u21205 \u12375 \u12383 \u12398 \u12424 \u12290 ');\
\});\
}